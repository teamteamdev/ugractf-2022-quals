# Крипто-департамент: Write-up

После решения задания [«Веб-департамент»](WRITEUP.webdept.md) мы авторизованы в системе под администратором. Кроме флага, мы также узнаём, что есть и вторая сеть — 10.13.38.0/24. Просканировав все порты 80 и в ней, находим странную веб-страницу для печати сообщений — 10.13.38.116.

Но какие же сообщения можно расшифровать? Вспоминаем о второй части сайта — сервисе с жалобами. Возвращаясь к ней уже с повышенными привилегиями, мы можем увидеть список последних жалоб. Но в зашифрованном виде.

Попробуем напечатать любую жалобу — и, действительно, сайт нам сообщает о её печати на принтере. Если же мы отправим абракадабру, то ничего не напечатается: нам скажут, что произошла ошибка.

> Обратите внимание: сама форма на загруженной странице работать и не будет — надо вручную дописывать `enc` именно в URL запроса.

Вспоминаем про AES-CBC, упомянутый ранее. Атака, которая подойдёт нам в этом случае — [Padding Oracle](https://robertheaton.com/2013/07/29/padding-oracle-attack/) — она позволяет всего лишь по сообщению о корректном или некорректном шифротексте получить флаг.

Посмотрим на формат зашифрованных сообщений. Независимо от длины сообщения, часть до `|` — base64 от 16 байт данных, а справа — base64 данных длины чуть большей того текста, что мы отправляем — если быть точным, длина округляется до 16 байт вверх.

Предпологаем, что слева от `|` находится IV, а справа — шифротекст, заполненный паддингом. Самый распространённый формат паддингов — PKCS7; предположим, что он и использовался.

[Код эксплойта](exploit.py)

Флаг: **ugra_do_not_ever_use_cbc_420d096df213**
